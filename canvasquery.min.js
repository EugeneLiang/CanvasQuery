/*     
  Canvas Query 0.8.3 work in progress
  http://canvasquery.org
  (c) 2012-2013 http://rezoner.net
  Canvas Query may be freely distributed under the MIT license.
*/

(function(l,v){var y=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);l.requestAnimationFrame=l.requestAnimationFrame||l.webkitRequestAnimationFrame||l.mozRequestAnimationFrame||l.oRequestAnimationFrame||l.msRequestAnimationFrame||function(a){l.setTimeout(a,1E3/60)};var g=function(a){if(0===arguments.length){var b=g.createCanvas(l.innerWidth,l.innerHeight);l.addEventListener("resize",function(){})}else if("string"===typeof a)b=document.querySelector(a);else if("number"===typeof a)b=
g.createCanvas(arguments[0],arguments[1]);else if(a instanceof Image||a instanceof HTMLImageElement)b=g.createCanvas(a);else{if(a instanceof g.Wrapper)return a;b=a}return new g.Wrapper(b)};g.extend=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[0][b]=arguments[a][b];return arguments[0]};g.augment=function(){for(var a=1;a<arguments.length;a++)_.extend(arguments[0],arguments[a]),arguments[a](arguments[0])};g.extend(g,{keycodes:{37:"left",38:"up",39:"right",40:"down",
45:"insert",46:"delete",8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},cleanArray:function(a,b){for(var c=
arguments[arguments.length-1],d="function"===typeof c,f=0,e=a.length;f<e;f++)if(null===a[f]||b&&a[f][b])d&&c(a[f]),a.splice(f--,1),e--},specialBlendFunctions:["color","value","hue","saturation"],blendFunctions:{normal:function(a,b){return b},overlay:function(a,b){a/=255;b/=255;return Math.min(255,Math.max(0,255*(0.5>a?2*a*b:1-2*(1-a)*(1-b))|0))},hardLight:function(a,b){return g.blendFunctions.overlay(b,a)},softLight:function(a,b){a/=255;b/=255;return g.limitValue(255*((1-2*b)*a*a+2*b*a),0,255)},dodge:function(a,
b){return Math.min(256*a/(255-b+1),255)},burn:function(a,b){return 255-Math.min(256*(255-a)/(b+1),255)},multiply:function(a,b){return b*a/255},divide:function(a,b){return Math.min(256*a/(b+1),255)},screen:function(a,b){return 255-(255-b)*(255-a)/255},grainExtract:function(a,b){return g.limitValue(a-b+128,0,255)},grainMerge:function(a,b){return g.limitValue(a+b-128,0,255)},difference:function(a,b){return Math.abs(a-b)},addition:function(a,b){return Math.min(a+b,255)},substract:function(a,b){return Math.max(a-
b,0)},darkenOnly:function(a,b){return Math.min(a,b)},lightenOnly:function(a,b){return Math.max(a,b)},color:function(a,b){var c=g.rgbToHsl(a),d=g.rgbToHsl(b);return g.hslToRgb(d[0],d[1],c[2])},hue:function(a,b){var c=g.rgbToHsv(a),d=g.rgbToHsv(b);return d[1]?g.hsvToRgb(d[0],c[1],c[2]):g.hsvToRgb(c[0],c[1],c[2])},value:function(a,b){var c=g.rgbToHsv(a),d=g.rgbToHsv(b);return g.hsvToRgb(c[0],c[1],d[2])},saturation:function(a,b){var c=g.rgbToHsv(a),d=g.rgbToHsv(b);return g.hsvToRgb(c[0],d[1],c[2])}},
blend:function(a,b,c,d){"undefined"===typeof d&&(d=1);a=g(a);b=g(b);var f=b.context,e=a.context.getImageData(0,0,a.canvas.width,a.canvas.height);b=f.getImageData(0,0,b.canvas.width,b.canvas.height);e=e.data;b=b.data;var f=this.createImageData(a.canvas.width,a.canvas.height),h=f.data,m=g.blendFunctions[c];if(-1!==g.specialBlendFunctions.indexOf(c)){c=0;for(var j=e.length;c<j;c+=4){var k=m([e[c+0],e[c+1],e[c+2]],[b[c+0],b[c+1],b[c+2]]);h[c+0]=e[c+0]+(k[0]-e[c+0])*d;h[c+1]=e[c+1]+(k[1]-e[c+1])*d;h[c+
2]=e[c+2]+(k[2]-e[c+2])*d;h[c+3]=e[c+3]}}else{c=0;for(j=e.length;c<j;c+=4){var k=m(e[c+0],b[c+0]),n=m(e[c+1],b[c+1]),l=m(e[c+2],b[c+2]);h[c+0]=e[c+0]+(k-e[c+0])*d;h[c+1]=e[c+1]+(n-e[c+1])*d;h[c+2]=e[c+2]+(l-e[c+2])*d;h[c+3]=e[c+3]}}a.context.putImageData(f,0,0);return a},wrapValue:function(a,b,c){c=Math.abs(c-b);return b+(a-b)%c},limitValue:function(a,b,c){return a<b?b:a>c?c:a},mix:function(a,b,c){return a+(b-a)*c},hexToRgb:function(a){return["0x"+a[1]+a[2]|0,"0x"+a[3]+a[4]|0,"0x"+a[5]+a[6]|0]},rgbToHex:function(a,
b,c){return"#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1,7)},rgbToHsl:function(a,b,c){a instanceof Array&&(c=a[2],b=a[1],a=a[0]);a/=255;b/=255;c/=255;var d=Math.max(a,b,c),f=Math.min(a,b,c),e,h=(d+f)/2;if(d==f)e=f=0;else{var g=d-f,f=0.5<h?g/(2-d-f):g/(d+f);switch(d){case a:e=(b-c)/g+(b<c?6:0);break;case b:e=(c-a)/g+2;break;case c:e=(a-b)/g+4}e/=6}return[e,f,h]},hslToRgb:function(a,b,c){if(0==b)c=b=a=c;else{var d=function(a,c,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(c-a)*b:0.5>b?c:b<2/3?
a+6*(c-a)*(2/3-b):a},f=0.5>c?c*(1+b):c+b-c*b,e=2*c-f;c=d(e,f,a+1/3);b=d(e,f,a);a=d(e,f,a-1/3)}return[255*c|0,255*b|0,255*a|0]},rgbToHsv:function(a,b,c){a instanceof Array&&(c=a[2],b=a[1],a=a[0]);a/=255;b/=255;c/=255;var d=Math.max(a,b,c),f=Math.min(a,b,c),e,h=d-f;if(d==f)e=0;else{switch(d){case a:e=(b-c)/h+(b<c?6:0);break;case b:e=(c-a)/h+2;break;case c:e=(a-b)/h+4}e/=6}return[e,0==d?0:h/d,d]},hsvToRgb:function(a,b,c){var d,f,e,h=Math.floor(6*a),g=6*a-h;a=c*(1-b);var j=c*(1-g*b);b=c*(1-(1-g)*b);switch(h%
6){case 0:d=c;f=b;e=a;break;case 1:d=j;f=c;e=a;break;case 2:d=a;f=c;e=b;break;case 3:d=a;f=j;e=c;break;case 4:d=b;f=a;e=c;break;case 5:d=c,f=a,e=j}return[255*d,255*f,255*e]},color:function(){var a=new g.Color;a.parse(arguments);return a},createCanvas:function(a,b){var c=document.createElement("canvas");a instanceof Image||a instanceof HTMLImageElement?(c.width=a.width,c.height=a.height,c.getContext("2d").drawImage(a,0,0)):(c.width=a,c.height=b);return c},createImageData:function(a,b){return document.createElement("Canvas").getContext("2d").createImageData(a,
b)},mousePosition:function(a){var b=0,c=0,d=a.target||a.srcElement,f=0,e=0;do b+=d.offsetLeft,c+=d.offsetTop;while(d=d.offsetParent);a.changedTouches&&a.changedTouches[0]!==v&&(a=a.changedTouches[0]);if(a.pageX||a.pageY)f=a.pageX,e=a.pageY;else if(a.clientX||a.clientY)f=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;return{x:f-b,y:e-c}}});g.Wrapper=function(a){this.context=a.getContext("2d");this.canvas=
a};g.Wrapper.prototype={appendTo:function(a){("object"===typeof a?a:document.querySelector(a)).appendChild(this.canvas);return this},blendOn:function(a,b,c){g.blend(a,this,b,c);return this},blend:function(a,b,c){if("string"===typeof a){var d=a;a=g(g.createCanvas(this.canvas.width,this.canvas.height));a.fillStyle(d).fillRect(0,0,this.canvas.width,this.canvas.height)}g.blend(this,a,b,c);return this},circle:function(a,b,c){this.context.arc(a,b,c,0,2*Math.PI);return this},crop:function(a,b,c,d){var f=
g.createCanvas(c,d);f.getContext("2d").drawImage(this.canvas,a,b,c,d,0,0,c,d);this.canvas.width=c;this.canvas.height=d;this.clear();this.context.drawImage(f,0,0);return this},set:function(a){g.extend(this.context,a)},resize:function(a,b){var c=a,d=b;null===b?this.canvas.width>a?(d=this.canvas.height*(a/this.canvas.width)|0,c=a):(c=this.canvas.width,d=this.canvas.height):null===a&&(this.canvas.width>a?(c=this.canvas.width*(b/this.canvas.height)|0,d=b):(c=this.canvas.width,d=this.canvas.height));c=
g(c,d).drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,c,d);this.canvas=c.canvas;this.context=c.context;return this},trim:function(a,b){var c;a?(a=g.color(a).toArray(),c=!a[3]):c=!0;for(var d=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,f=[this.canvas.width,this.canvas.height,0,0],e=0,h=d.length;e<h;e+=4){if(c){if(!d[e+3])continue}else if(d[e+0]===a[0]&&d[e+1]===a[1]&&d[e+2]===a[2])continue;var m=(e/4|0)%this.canvas.width|0,j=(e/4|0)/this.canvas.width|
0;m<f[0]&&(f[0]=m);m>f[2]&&(f[2]=m);j<f[1]&&(f[1]=j);j>f[3]&&(f[3]=j)}0===f[2]||0===f[3]||(b&&(b.left=f[0],b.top=f[1],b.width=f[2]-f[0],b.height=f[3]-f[1]),this.crop(f[0],f[1],f[2]-f[0]+1,f[3]-f[1]+1));return this},resizePixel:function(a){var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,c=document.createElement("canvas"),d=c.context=c.getContext("2d");c.width=this.canvas.width*a|0;c.height=this.canvas.height*a|0;for(var f=0,e=b.length;f<e;f+=4)b[f+3]&&(d.fillStyle=g.rgbToHex(b[f+
0],b[f+1],b[f+2]),d.fillRect(f/4%this.canvas.width*a,(f/4/this.canvas.width|0)*a,a,a));this.canvas.width=c.width;this.canvas.height=c.height;this.clear().drawImage(c,0,0);return this},matchPalette:function(a){for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=[],d=0;d<a.length;d++)c.push(g.color(a[d]));for(d=0;d<b.data.length;d+=4){for(var f=[],e=0;e<c.length;e++){var h=c[e],m=Math.abs(b.data[d]-h[0]),j=Math.abs(b.data[d+1]-h[1]),h=Math.abs(b.data[d+2]-h[2]);f.push(m+
j+h)}for(e=m=0;e<a.length;e++)f[e]<f[m]&&(m=e);f=cq.hexToRgb(a[m]);b.data[d]=f[0];b.data[d+1]=f[1];b.data[d+2]=f[2]}this.context.putImageData(b,0,0);return this},getPalette:function(){for(var a=[],b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,c=0,d=b.length;c<d;c+=4)if(b[c+3]){var f=g.rgbToHex(b[c+0],b[c+1],b[c+2]);-1===a.indexOf(f)&&a.push(f)}return a},pixelize:function(a){if(!a)return this;var b=this.context.mozImageSmoothingEnabled,c=this.context.webkitImageSmoothingEnabled;
this.context.mozImageSmoothingEnabled=!1;this.context.webkitImageSmoothingEnabled=!1;a=this.canvas.width/(a||4)/this.canvas.width;var d=cq(this.canvas.width,this.canvas.height);d.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.canvas.width*a|0,this.canvas.height*a|0);this.clear().drawImage(d.canvas,0,0,this.canvas.width*a|0,this.canvas.height*a|0,0,0,this.canvas.width,this.canvas.height);this.context.mozImageSmoothingEnabled=b;this.context.webkitImageSmoothingEnabled=c;return this},
colorToMask:function(a,b){a=g.color(a).toArray();for(var c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,d=[],f=0,e=c.length;f<e;f+=4)c[f+0]==a[0]&&c[f+1]==a[1]&&c[f+2]==a[2]?d.push(b||!1):d.push(!b);return d},grayscaleToMask:function(a){g.color(a).toArray();a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data;for(var b=[],c=0,d=a.length;c<d;c+=4)b.push((a[c+0]+a[c+1]+a[c+2])/3|0);return b},grayscaleToAlpha:function(){for(var a=this.context.getImageData(0,
0,this.canvas.width,this.canvas.height),b=a.data,c=0,d=b.length;c<d;c+=4)b[c+3]=(b[c+0]+b[c+1]+b[c+2])/3|0,b[c+0]=b[c+1]=b[c+2]=255;this.context.putImageData(a,0,0);return this},applyMask:function(a){for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,d="boolean"===typeof a[0]?"bool":"byte",f=0,e=c.length;f<e;f+=4){var h=a[f/4];c[f+3]="bool"===d?255*h|0:h|0}this.context.putImageData(b,0,0);return this},fillMask:function(a){var b=this.context.getImageData(0,0,this.canvas.width,
this.canvas.height),c=b.data,d="boolean"===typeof a[0]?"bool":"byte",f=2===arguments.length?"normal":"gradient",e=g.color(arguments[1]);"gradient"===f&&(colorB=g.color(arguments[2]));for(var h=0,m=c.length;h<m;h+=4){var j=a[h/4];"byte"===d&&(j/=255);"normal"===f?j&&(c[h+0]=e[0]|0,c[h+1]=e[1]|0,c[h+2]=e[2]|0,c[h+3]=255*j|0):(c[h+0]=e[0]+(colorB[0]-e[0])*j|0,c[h+1]=e[1]+(colorB[1]-e[1])*j|0,c[h+2]=e[2]+(colorB[2]-e[2])*j|0,c[h+3]=255)}this.context.putImageData(b,0,0);return this},clear:function(a){a?
(this.context.fillStyle=a,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height);return this},clone:function(){var a=g.createCanvas(this.canvas.width,this.canvas.height);a.getContext("2d").drawImage(this.canvas,0,0);return g(a)},fillStyle:function(a){this.context.fillStyle=a;return this},strokeStyle:function(a){this.context.strokeStyle=a;return this},gradientText:function(a,b,c,d,f){var e=a.split(" "),h=2*this.font().match(/\d+/g)[0],
g=0,j=0;if(d)for(var j=0,k=[""],n=0;n<e.length;n++){a=e[n]+" ";var l=this.context.measureText(a).width;g+l>d&&(k[++j]="",g=0);k[j]+=a;g+=l}else k=[a];for(n=0;n<k.length;n++){j=c+0.6*n*h|0;d=this.context.createLinearGradient(0,j,0,j+0.6*h|0);for(e=0;e<f.length;e+=2)d.addColorStop(f[e],f[e+1]);a=k[n];this.fillStyle(d).fillText(a,b,j)}return this},setHsl:function(){var a=1===arguments.length?arguments[0]:arguments,b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,d,f,e;e=
[];d=[];for(var h=0,m=c.length;h<m;h+=4)e=g.rgbToHsl(c[h+0],c[h+1],c[h+2]),d=null===a[0]?e[0]:g.limitValue(a[0],0,1),f=null===a[1]?e[1]:g.limitValue(a[1],0,1),e=null===a[2]?e[2]:g.limitValue(a[2],0,1),d=g.hslToRgb(d,f,e),c[h+0]=d[0],c[h+1]=d[1],c[h+2]=d[2];this.context.putImageData(b,0,0);return this},shiftHsl:function(){var a=1===arguments.length?arguments[0]:arguments,b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,d,f,e;e=[];d=[];for(var h=0,m=c.length;h<m;h+=4)e=
g.rgbToHsl(c[h+0],c[h+1],c[h+2]),d=null===a[0]?e[0]:g.wrapValue(e[0]+a[0],0,1),f=null===a[1]?e[1]:g.limitValue(e[1]+a[1],0,1),e=null===a[2]?e[2]:g.limitValue(e[2]+a[2],0,1),d=g.hslToRgb(d,f,e),c[h+0]=d[0],c[h+1]=d[1],c[h+2]=d[2];this.context.putImageData(b,0,0);return this},replaceHue:function(a,b){var c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),d=c.data,f,e=[];f=[];for(var h=0,m=d.length;h<m;h+=4)e=g.rgbToHsl(d[h+0],d[h+1],d[h+2]),f=0.05>Math.abs(e[0]-a)?g.wrapValue(b,0,
1):e[0],f=g.hslToRgb(f,e[1],e[2]),d[h+0]=f[0],d[h+1]=f[1],d[h+2]=f[2];this.context.putImageData(c,0,0);return this},invert:function(){for(var a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=a.data,c=0,d=b.length;c<d;c+=4)b[c+0]=255-b[c+0],b[c+1]=255-b[c+1],b[c+2]=255-b[c+2];this.context.putImageData(a,0,0);return this},roundRect:function(a,b,c,d,f){this.beginPath();this.moveTo(a+f,b);this.lineTo(a+c-f,b);this.quadraticCurveTo(a+c,b,a+c,b+f);this.lineTo(a+c,b+d-f);this.quadraticCurveTo(a+
c,b+d,a+c-f,b+d);this.lineTo(a+f,b+d);this.quadraticCurveTo(a,b+d,a,b+d-f);this.lineTo(a,b+f);this.quadraticCurveTo(a,b,a+f,b);this.closePath();return this},wrappedText:function(a,b,c,d,f){var e=a.split(" "),h=2*this.font().match(/\d+/g)[0],g=0,j=0;if(d){a=0;for(var k=[""],n=0;n<e.length;n++){var j=e[n]+" ",l=this.context.measureText(j).width;g+l>d&&(k[++a]="",g=0);k[a]+=j;g+=l}}else k=[a];for(n=0;n<k.length;n++)j=c+0.6*n*h|0,a=k[n],f&&f.call(this,b,c+j),this.fillText(a,b,j);return this},textBoundaries:function(a,
b){var c=a.split(" "),d=2*this.font().match(/\d+/g)[0],f=0;if(b)for(var e=0,h=[""],g=0;g<c.length;g++){var j=c[g]+" ",k=this.context.measureText(j).width;f+k>b&&(h[++e]="",f=0);h[e]+=j;f+=k}else h=[a],b=this.measureText(a).width;return{height:0.6*h.length*d|0,width:b}},paperBag:function(a,b,c,d,f,e){this.beginPath();this.moveTo(a,b);this.quadraticCurveTo(a+c/2|0,b+d*e|0,a+c,b);this.quadraticCurveTo(a+c-c*f|0,b+d/2|0,a+c,b+d);this.quadraticCurveTo(a+c/2|0,b+d-d*e|0,a,b+d);this.quadraticCurveTo(a+c*
f|0,b+d/2|0,a,b)},borderImage:function(a,b,c,d,f,e,h,g,j,k){this.drawImage(a,j,0,a.width-j-h,e,b+j,c,d-j-h,e);this.drawImage(a,j,a.height-g,a.width-j-h,g,b+j,c+f-g,d-j-h,g);this.drawImage(a,0,e,j,a.height-g-e,b,c+e,j,f-g-e);this.drawImage(a,a.width-h,e,h,a.height-g-e,b+d-h,c+e,h,f-g-e);this.drawImage(a,0,0,j,e,b,c,j,e);this.drawImage(a,a.width-h,0,h,e,b+d-h,c,h,e);this.drawImage(a,a.width-h,a.height-g,h,g,b+d-h,c+f-g,h,g);this.drawImage(a,0,a.height-g,j,g,b,c+f-g,j,g);k&&("string"===typeof k?this.fillStyle(k).fillRect(b+
j,c+e,d-j-h,f-e-g):this.drawImage(a,j,e,a.width-h-j,a.height-g-e,b+j,c+e,d-j-h,f-e-g))},convolve:function(a,b,c){"undefined"===typeof c&&(c=1);"undefined"===typeof b&&(b=1);for(var d=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),f=Math.sqrt(a.length)+0.5|0,e=f/2|0,h=d.data,m=d.width,d=d.height,j=g.createImageData(this.canvas.width,this.canvas.height),k=j.data,n=1;n<d-1;n++)for(var l=1;l<m-1;l++){for(var r=4*(n*m+l),z=0,p=0,q=0,w=0;w<f;w++)for(var x=0;x<f;x++){var s=n+w-e,t=l+
x-e;0<=s&&(s<d&&0<=t&&t<m)&&(s=4*(s*m+t),t=a[w*f+x]/c,z+=h[s+0]*t,p+=h[s+1]*t,q+=h[s+2]*t)}k[r+0]=g.mix(h[r+0],z,b);k[r+1]=g.mix(h[r+1],p,b);k[r+2]=g.mix(h[r+2],q,b);k[r+3]=h[r+3]}this.context.putImageData(j,0,0);return this},blur:function(a){return this.convolve([1,1,1,1,1,1,1,1,1],a,9)},gaussianBlur:function(a){return this.convolve([6.7E-7,2.292E-5,1.9117E-4,3.8771E-4,1.9117E-4,2.292E-5,6.7E-7,2.292E-5,7.8633E-4,0.00655965,0.01330373,0.00655965,7.8633E-4,2.292E-5,1.9117E-4,0.00655965,0.05472157,
0.11098164,0.05472157,0.00655965,1.9117E-4,3.8771E-4,0.01330373,0.11098164,0.22508352,0.11098164,0.01330373,3.8771E-4,1.9117E-4,0.00655965,0.05472157,0.11098164,0.05472157,0.00655965,1.9117E-4,2.292E-5,7.8633E-4,0.00655965,0.01330373,0.00655965,7.8633E-4,2.292E-5,6.7E-7,2.292E-5,1.9117E-4,3.8771E-4,1.9117E-4,2.292E-5,6.7E-7],a,1)},sharpen:function(a){return this.convolve([0,-1,0,-1,5,-1,0,-1,0],a)},threshold:function(a){for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),
c=b.data,d,f,e,g=0;g<c.length;g+=4)d=c[g],f=c[g+1],e=c[g+2],c[g]=c[g+1]=c[g+2]=0.2126*d+0.7152*f+0.0722*e>=a?255:0;this.context.putImageData(b,0,0);return this},sepia:function(){for(var a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=a.data,c=0;c<b.length;c+=4)b[c+0]=g.limitValue(0.393*b[c+0]+0.769*b[c+1]+0.189*b[c+2],0,255),b[c+1]=g.limitValue(0.349*b[c+0]+0.686*b[c+1]+0.168*b[c+2],0,255),b[c+2]=g.limitValue(0.272*b[c+0]+0.534*b[c+1]+0.131*b[c+2],0,255);this.context.putImageData(a,
0,0);return this},measureText:function(){return this.context.measureText.apply(this.context,arguments)},createRadialGradient:function(){return this.context.createRadialGradient.apply(this.context,arguments)},createLinearGradient:function(){return this.context.createLinearGradient.apply(this.context,arguments)},getImageData:function(){return this.context.getImageData.apply(this.context,arguments)},framework:function(a,b){b&&(this.tempContext=!0===b?a:b);for(var c in a)if(this[c])this[c](a[c],v,v);
this.tempContext=null;return this},onStep:function(a,b){var c=this.tempContext||this,d=Date.now();this.timer=setInterval(function(){var b=Date.now()-d;d=Date.now();a.call(c,b,d)},b);return this},onRender:function(a){function b(){var f=Date.now()-d;d=Date.now();requestAnimationFrame(b);a.call(c,f,d)}var c=this.tempContext||this,d=Date.now();requestAnimationFrame(b);return this},onMouseMove:function(a){var b=this.tempContext||this;y?this.canvas.addEventListener("touchmove",function(c){c.preventDefault();
c=g.mousePosition(c);a.call(b,c.x,c.y)}):this.canvas.addEventListener("mousemove",function(c){c=g.mousePosition(c);a.call(b,c.x,c.y)});return this},onMouseDown:function(a){var b=this.tempContext||this;y?this.canvas.addEventListener("touchstart",function(c){var d=g.mousePosition(c);a.call(b,d.x,d.y,c.button)}):this.canvas.addEventListener("mousedown",function(c){var d=g.mousePosition(c);a.call(b,d.x,d.y,c.button)});return this},onMouseUp:function(a){var b=this.tempContext||this;y?this.canvas.addEventListener("touchend",
function(c){var d=g.mousePosition(c);a.call(b,d.x,d.y,c.button)}):this.canvas.addEventListener("mouseup",function(c){var d=g.mousePosition(c);a.call(b,d.x,d.y,c.button)});return this},onSwipe:function(a,b,c){function d(a){a.preventDefault();k=g.mousePosition(a);n=Date.now()}function f(a){a.preventDefault();p=g.mousePosition(a);q=Date.now()}function e(b){b.preventDefault();b=k.x-p.x;var c=k.y-p.y,d=Math.sqrt(b*b+c*c),e=q-n,f=v;d>l&&e<j&&(f=Math.abs(b)>Math.abs(c)?0<b?"left":"right":0<c?"up":"down",
a.call(h,f))}var h=this.tempContext||this,l=b||35,j=c||350,k=0,n=0,p=0,q=0;this.canvas.addEventListener("touchstart",function(a){d(a)});this.canvas.addEventListener("touchmove",function(a){f(a)});this.canvas.addEventListener("touchend",function(a){e(a)});this.canvas.addEventListener("mousedown",function(a){d(a)});this.canvas.addEventListener("mousemove",function(a){f(a)});this.canvas.addEventListener("mouseup",function(a){e(a)});return this},onKeyDown:function(a){document.addEventListener("keydown",
function(b){b=48<=b.which&&90>=b.which?String.fromCharCode(b.which).toLowerCase():g.keycodes[b.which];a.call(self,b)});return this},onKeyUp:function(a){document.addEventListener("keyup",function(b){b=48<=b.which&&90>=b.which?String.fromCharCode(b.which).toLowerCase():g.keycodes[b.which];a.call(self,b)});return this},onResize:function(a){var b=this;l.addEventListener("resize",function(){a.call(b,l.innerWidth,l.innerHeight)});a.call(b,l.innerWidth,l.innerHeight);return this},onDropImage:function(a){var b=
this;document.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();c=c.dataTransfer.files[0];if(!/image/i.test(c.type))return!1;var d=new FileReader;d.onload=function(c){var d=new Image;d.onload=function(){a.call(b,this)};d.src=c.target.result};d.readAsDataURL(c)});document.addEventListener("dragover",function(a){a.preventDefault()});return this}};for(var u="arc arcTo beginPath bezierCurveTo clearRect clip closePath createImageData createLinearGradient createRadialGradient createPattern drawFocusRing drawImage fill fillRect fillText getImageData isPointInPath lineTo measureText moveTo putImageData quadraticCurveTo rect restore rotate save scale setTransform stroke strokeRect strokeText transform translate".split(" "),
q=0;q<u.length;q++){var p=u[q];g.Wrapper.prototype[p]||(g.Wrapper.prototype[p]=Function("this.context."+p+".apply(this.context, arguments); return this;"))}u="canvas fillStyle font globalAlpha globalCompositeOperation lineCap lineJoin lineWidth miterLimit shadowOffsetX shadowOffsetY shadowBlur shadowColor strokeStyle textAlign textBaseline".split(" ");for(q=0;q<u.length;q++)p=u[q],g.Wrapper.prototype[p]||(g.Wrapper.prototype[p]=Function("if(arguments.length) { this.context."+p+" = arguments[0]; return this; } else { return this.context."+
p+"; }"));g.Color=function(){arguments.length&&this.parse(arguments)};g.Color.prototype={parse:function(a){if("string"===typeof a[0]){var b=null;if("#"===a[0][0])a=g.hexToRgb(a[0]),this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=1;else if(b=a[0].match(/rgb\((.*),(.*),(.*)\)/))this[0]=b[1]|0,this[1]=b[2]|0,this[2]=b[3]|0,this[3]=1;else if(b=a[0].match(/rgba\((.*),(.*),(.*)\)/))this[0]=b[1]|0,this[1]=b[2]|0,this[2]=b[3]|0,this[3]=b[4]|0;else if(b=a[0].match(/hsl\((.*),(.*),(.*)\)/))a=g.hslToRgb(b[1],
b[2],b[3]),this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=1;else if(b=a[0].match(/hsv\((.*),(.*),(.*)\)/))a=g.hsTvoRgb(b[1],b[2],b[3]),this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=1}else this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]="undefined"===typeof a[3]?1:a[3]},toArray:function(){return[this[0],this[1],this[2],this[3]]},toRgb:function(){return"rgb("+this[0]+", "+this[1]+", "+this[2]+")"},toRgba:function(){return"rgba("+this[0]+", "+this[1]+", "+this[2]+", "+this[3]+")"},toHex:function(){return g.rgbToHex(this[0],
this[1],this[2])},toHsl:function(){return g.rgbToHsl(this[0],this[1],this[2])},toHsv:function(){return g.rgbToHsv(this[0],this[1],this[2])}};l.cq=l.CanvasQuery=g;"function"===typeof define&&define.amd&&define([],function(){return g})})(window);